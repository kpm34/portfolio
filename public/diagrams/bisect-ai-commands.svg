<svg width="1300" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Inter, sans-serif; font-size: 24px; font-weight: 600; fill: #ffffff; }
      .subtitle { font-family: Inter, sans-serif; font-size: 14px; fill: #a0a0a0; }
      .section-title { font-family: Inter, sans-serif; font-size: 16px; font-weight: 600; fill: #ffffff; }
      .label { font-family: Inter, sans-serif; font-size: 13px; font-weight: 500; fill: #e5e5e5; }
      .sub-label { font-family: Inter, sans-serif; font-size: 11px; fill: #a0a0a0; }
      .tech-label { font-family: monospace; font-size: 10px; fill: #9ca3af; }
      .code { font-family: monospace; font-size: 10px; fill: #60a5fa; }
      .box { fill: rgba(255, 255, 255, 0.05); stroke: rgba(255, 255, 255, 0.1); stroke-width: 1; rx: 8; }
      .box-emerald { fill: rgba(16, 185, 129, 0.1); stroke: rgba(16, 185, 129, 0.3); stroke-width: 1.5; rx: 8; }
      .box-blue { fill: rgba(59, 130, 246, 0.1); stroke: rgba(59, 130, 246, 0.3); stroke-width: 1.5; rx: 8; }
      .box-purple { fill: rgba(168, 85, 247, 0.1); stroke: rgba(168, 85, 247, 0.3); stroke-width: 1.5; rx: 8; }
      .box-orange { fill: rgba(249, 115, 22, 0.1); stroke: rgba(249, 115, 22, 0.3); stroke-width: 1.5; rx: 8; }
      .box-cyan { fill: rgba(6, 182, 212, 0.1); stroke: rgba(6, 182, 212, 0.3); stroke-width: 1.5; rx: 8; }
      .box-pink { fill: rgba(236, 72, 153, 0.1); stroke: rgba(236, 72, 153, 0.3); stroke-width: 1.5; rx: 8; }
      .arrow { stroke: #10b981; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-blue { stroke: #3b82f6; stroke-width: 2; fill: none; marker-end: url(#arrowhead-blue); }
      .arrow-purple { stroke: #a855f7; stroke-width: 2; fill: none; marker-end: url(#arrowhead-purple); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3b82f6" />
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#a855f7" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1300" height="900" fill="#030303"/>

  <!-- Title -->
  <text x="650" y="40" text-anchor="middle" class="title">AI Command System</text>
  <text x="650" y="65" text-anchor="middle" class="subtitle">Natural Language to 3D Scene Manipulation with GPT-4o</text>

  <!-- User Input -->
  <g id="input">
    <text x="100" y="110" class="section-title">User Input</text>

    <rect x="50" y="130" width="350" height="120" class="box-emerald"/>
    <text x="225" y="160" text-anchor="middle" class="label">Command Input Interface</text>

    <rect x="70" y="180" width="310" height="50" class="box"/>
    <text x="225" y="210" text-anchor="middle" class="tech-label">"Make the cube red and move it up 2 units"</text>

    <text x="225" y="240" text-anchor="middle" class="sub-label">Natural language commands in chat interface</text>
  </g>

  <!-- Context Builder -->
  <g id="context">
    <text x="480" y="110" class="section-title">Context Builder</text>

    <rect x="430" y="130" width="400" height="120" class="box-blue"/>
    <text x="630" y="160" text-anchor="middle" class="label">AgentContext Assembly</text>

    <rect x="450" y="175" width="110" height="55" class="box"/>
    <text x="505" y="200" text-anchor="middle" class="sub-label">Scene Data</text>
    <text x="505" y="218" text-anchor="middle" class="tech-label">JSON tree</text>

    <rect x="575" y="175" width="110" height="55" class="box"/>
    <text x="630" y="200" text-anchor="middle" class="sub-label">Screenshot</text>
    <text x="630" y="218" text-anchor="middle" class="tech-label">Base64 image</text>

    <rect x="700" y="175" width="110" height="55" class="box"/>
    <text x="755" y="200" text-anchor="middle" class="sub-label">Selection</text>
    <text x="755" y="218" text-anchor="middle" class="tech-label">Object IDs</text>
  </g>

  <!-- Arrow -->
  <line x1="400" y1="190" x2="430" y2="190" class="arrow"/>

  <!-- GPT-4o -->
  <g id="gpt4o">
    <text x="920" y="110" class="section-title">AI Provider</text>

    <rect x="870" y="130" width="380" height="120" class="box-purple"/>
    <text x="1060" y="160" text-anchor="middle" class="label">OpenAI GPT-4o</text>

    <text x="890" y="185" class="tech-label">Model: gpt-4o (vision-capable)</text>
    <text x="890" y="205" class="tech-label">Input: $2.50 / 1M tokens</text>
    <text x="890" y="225" class="tech-label">Output: $10.00 / 1M tokens</text>
    <text x="890" y="245" class="tech-label">Context: Command + Scene + Screenshot</text>
  </g>

  <!-- Arrow -->
  <line x1="830" y1="190" x2="870" y2="190" class="arrow-purple"/>

  <!-- Unified Agent -->
  <g id="agent">
    <text x="100" y="300" class="section-title">Unified Spline Agent (642 lines)</text>

    <rect x="50" y="320" width="600" height="250" class="box-orange"/>
    <text x="350" y="350" text-anchor="middle" class="label">unified-spline-agent.ts / browser-agent-adapter.ts</text>

    <!-- System Prompt -->
    <rect x="70" y="370" width="270" height="180" class="box"/>
    <text x="205" y="395" text-anchor="middle" class="sub-label">System Prompt Capabilities</text>
    <text x="90" y="420" class="tech-label">3D spatial composition</text>
    <text x="90" y="440" class="tech-label">Object manipulation (pos/rot/scale)</text>
    <text x="90" y="460" class="tech-label">Material design (color/rough/metal)</text>
    <text x="90" y="480" class="tech-label">Spline NodeMaterial uniforms</text>
    <text x="90" y="500" class="tech-label">Math functions (grid, circle, etc)</text>
    <text x="90" y="520" class="tech-label">Multi-object selection handling</text>

    <!-- Execution Plan -->
    <rect x="360" y="370" width="270" height="180" class="box"/>
    <text x="495" y="395" text-anchor="middle" class="sub-label">ExecutionPlan Output</text>
    <text x="380" y="420" class="code">approach: 'direct-api' |</text>
    <text x="380" y="435" class="code">  'math-function' | 'combined'</text>
    <text x="380" y="460" class="code">reasoning: string</text>
    <text x="380" y="480" class="code">commands: AgentCommand[]</text>
    <text x="380" y="500" class="code">validation: {</text>
    <text x="380" y="515" class="code">  expectedOutcome,</text>
    <text x="380" y="530" class="code">  checkPoints }</text>
  </g>

  <!-- Command Types -->
  <g id="commands">
    <text x="720" y="300" class="section-title">Command Types</text>

    <rect x="680" y="320" width="570" height="250" class="box-cyan"/>

    <!-- Spline API -->
    <rect x="700" y="350" width="170" height="100" class="box"/>
    <text x="785" y="375" text-anchor="middle" class="sub-label">spline-api</text>
    <text x="720" y="400" class="tech-label">Direct object manipulation</text>
    <text x="720" y="420" class="code">setColor(id, '#ff0000')</text>
    <text x="720" y="440" class="code">setPosition(id, 0, 2, 0)</text>

    <!-- Math -->
    <rect x="890" y="350" width="170" height="100" class="box"/>
    <text x="975" y="375" text-anchor="middle" class="sub-label">math</text>
    <text x="910" y="400" class="tech-label">Spatial math functions</text>
    <text x="910" y="420" class="code">gridLayout(objects, 3, 3)</text>
    <text x="910" y="440" class="code">circularArrange(objects, 5)</text>

    <!-- Script -->
    <rect x="1080" y="350" width="150" height="100" class="box"/>
    <text x="1155" y="375" text-anchor="middle" class="sub-label">script</text>
    <text x="1100" y="400" class="tech-label">Pre-built scripts</text>
    <text x="1100" y="420" class="code">duplicateObject()</text>
    <text x="1100" y="440" class="code">alignToGrid()</text>

    <!-- Math Functions Detail -->
    <rect x="700" y="465" width="530" height="90" class="box-pink"/>
    <text x="965" y="490" text-anchor="middle" class="sub-label">SpatialMath.ts Functions</text>
    <text x="720" y="515" class="tech-label">gridLayout | circularArrange | spiralDistribute | wavePattern</text>
    <text x="720" y="535" class="tech-label">scatterRandom | alignToAxis | stackVertical | mirrorObjects</text>
  </g>

  <!-- Execution -->
  <g id="execution">
    <text x="100" y="620" class="section-title">Command Execution</text>

    <rect x="50" y="640" width="550" height="150" class="box"/>

    <rect x="70" y="665" width="160" height="105" class="box-emerald"/>
    <text x="150" y="690" text-anchor="middle" class="sub-label">Parse Commands</text>
    <text x="90" y="715" class="tech-label">JSON structured output</text>
    <text x="90" y="735" class="tech-label">Validate command types</text>
    <text x="90" y="755" class="tech-label">Check object existence</text>

    <rect x="250" y="665" width="160" height="105" class="box-blue"/>
    <text x="330" y="690" text-anchor="middle" class="sub-label">Execute Sequentially</text>
    <text x="270" y="715" class="tech-label">UniversalEditor API</text>
    <text x="270" y="735" class="tech-label">Adapter routing</text>
    <text x="270" y="755" class="tech-label">Error handling</text>

    <rect x="430" y="665" width="150" height="105" class="box-orange"/>
    <text x="505" y="690" text-anchor="middle" class="sub-label">Validate Result</text>
    <text x="450" y="715" class="tech-label">Check expectedOutcome</text>
    <text x="450" y="735" class="tech-label">Verify checkPoints</text>
    <text x="450" y="755" class="tech-label">Report success/fail</text>

    <line x1="230" y1="715" x2="250" y2="715" class="arrow"/>
    <line x1="410" y1="715" x2="430" y2="715" class="arrow"/>
  </g>

  <!-- RAG System -->
  <g id="rag">
    <text x="680" y="620" class="section-title">RAG Memory System (Optional)</text>

    <rect x="630" y="640" width="620" height="150" class="box" style="stroke-dasharray: 5,5;"/>
    <text x="940" y="670" text-anchor="middle" class="label">browser-rag-system.ts</text>

    <rect x="650" y="695" width="180" height="75" class="box"/>
    <text x="740" y="720" text-anchor="middle" class="sub-label">Store Edits</text>
    <text x="670" y="745" class="tech-label">Command + Result pairs</text>
    <text x="670" y="760" class="tech-label">Embedded in ChromaDB</text>

    <rect x="850" y="695" width="180" height="75" class="box"/>
    <text x="940" y="720" text-anchor="middle" class="sub-label">Retrieve Similar</text>
    <text x="870" y="745" class="tech-label">Vector similarity search</text>
    <text x="870" y="760" class="tech-label">Top-k relevant examples</text>

    <rect x="1050" y="695" width="180" height="75" class="box"/>
    <text x="1140" y="720" text-anchor="middle" class="sub-label">Augment Context</text>
    <text x="1070" y="745" class="tech-label">Add to AgentContext</text>
    <text x="1070" y="760" class="tech-label">Improve accuracy</text>
  </g>

  <!-- Data Flow -->
  <g id="dataflow">
    <text x="100" y="830" class="section-title">Complete Flow</text>

    <rect x="50" y="850" width="1200" height="35" class="box"/>
    <text x="650" y="873" text-anchor="middle" class="tech-label">User Command to Context Assembly to GPT-4o API to ExecutionPlan to Sequential Commands to UniversalEditor to Adapter to Scene Update</text>
  </g>

</svg>
